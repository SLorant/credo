---
import Preciz from "./svg/preciz.astro";
import Krea from "./svg/krea.astro";
import Stonks from "./svg/stonks.astro";
---

<section>
  <img class="background3" src="/g1.webp" alt="gradient" />
  <div data-section="pillars" class="container">
    <h2 class="header">
      együttműködésünk <br />
      <span class="three">három</span> pillérre épül:
    </h2>
    <div class="grid">
      <div class="griditem">
        <img
          class="korte"
          src="/illustrations/kreakorte.svg"
          alt="second pillar"
        />
        <Krea />
        <p class="info">Kiemelkedő vizuális világra és kreatív koncepcióra.</p>
      </div>
      <div class="griditem">
        <img
          class="korte"
          src="/illustrations/precizkorte.svg"
          alt="second pillar"
        />
        <Preciz />
        <p class="info">Adatalapú, precíz, valamint hatékony kivitelezésre.</p>
      </div>
      <div class="griditem">
        <img
          class="korte"
          src="/illustrations/stonkskorte.svg"
          alt="second pillar"
        />
        <Stonks />
        <p class="info">És a stratégia vezette, hosszú távú növekedésre.</p>
      </div>
    </div>
    <div class="box">
      <p class="uppercase">
        A vízión túl a teljes márkatervezéstől, <br /> a napi megvalósításon át egészen
        az időszerű megújulásig, <br />
        <span class="bold"
          >a fejlődés minden fázisában segítjük ügyfeleinket.</span
        >
      </p>
    </div>
  </div>
</section>

<script>
  import { animate, onScroll } from "animejs";
  const isShortScreen = window.innerHeight < 900;

  const getEnterValue = (desktopRem: number, mobileRem: number) => {
    if (isShortScreen) return `bottom-=${mobileRem}rem top`;
    return `bottom-=${desktopRem}rem top`;
  };

  const animations = [
    { selector: ".header", enter: getEnterValue(25, 8) },
    { selector: ".korte", enter: getEnterValue(18.75, 6) },
    { selector: ".info", enter: getEnterValue(6.25, 1) },
    { selector: ".box", enter: getEnterValue(6.25, 1) },
  ];

  if (window.innerWidth >= 768) {
    animations.forEach(({ selector, enter }) => {
      animate(selector, {
        opacity: [0, 1],
        translateY: [30, 0],
        ease: "inOutSine",
        duration: 600,
        autoplay: onScroll({
          enter,
          leave: "top bottom",
          sync: "play reverse",
        }),
      });
    });
  } else {
    animate(".header", {
      opacity: [0, 1],
      translateY: [30, 0],
      ease: "inOutSine",
      duration: 600,
      autoplay: onScroll({
        enter: "bottom-=20rem top",
        leave: "top bottom",
        sync: "play reverse",
      }),
    });
  }

  // Trigger SVG animations when they come into view
  const svgs = document.querySelectorAll("#Layer_2");

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("start");
          observer.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.9, // Trigger when 90% of the SVG is visible
    },
  );

  svgs.forEach((svg, index) => {
    // Add staggered delay: 0ms, 200ms, 400ms
    const delay = index * 600;

    const delayedObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            setTimeout(() => {
              entry.target.classList.add("start");
            }, delay);
            delayedObserver.unobserve(entry.target);
          }
        });
      },
      {
        threshold: 1,
      },
    );

    delayedObserver.observe(svg);
  });

  // Animate underline for bold text
  const boldText = document.querySelector(".bold");

  const boldObserver = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add("animate-underline");
          boldObserver.unobserve(entry.target);
        }
      });
    },
    {
      threshold: 0.5,
    },
  );

  if (boldText) {
    boldObserver.observe(boldText);
  }
</script>

<style>
  section {
    height: 100%;
    position: relative;
    z-index: 20;
    width: 100vw;
    scrollbar-gutter: stable;
  }
  .container {
    width: 1200px;
    max-width: 1200px;
    height: 100%;
    position: relative;
    z-index: 30;
    display: flex;
    flex-direction: column;
    place-items: center;
    justify-content: start;
    margin: 0 auto;
    /*  background-image: url("gradient.webp");
    background-size: cover; */
    color: white;
    padding-top: 37.5rem;
    padding-bottom: 8rem;
  }
  .background3 {
    position: absolute;
    width: 100vw;
    height: 169%;
    top: 0;
    left: 0;
    z-index: 20;
  }
  .grid {
    display: grid;
    /*  grid-template-columns: repeat(3, 18.75rem);
    gap: 6.25rem; */
    grid-template-columns: repeat(3, 1fr);
    gap: 8rem;
    width: 100%;
    margin-bottom: 20px;
    z-index: 30;
  }
  .griditem {
    display: flex;
    flex-direction: column;
    place-items: center;
    justify-content: center;
    position: relative;
  }
  .korte {
    position: absolute;
    top: 0;
    left: 0;
    /*    backdrop-filter: blur(20px); */
  }
  object {
    position: relative;
    z-index: 30;
  }
  img {
    width: 18.75rem;
  }
  h2 {
    font-weight: 400;
    font-family: "AktivGrotesk Regular";
    font-size: var(--header-lg);
    text-align: center;
    line-height: var(--header-xl);
    margin-bottom: 20px;
    z-index: 30;
  }
  p {
    text-align: center;
    font-family: "AktivGrotesk Medium";
  }
  .three {
    font-family: "Kepler";
    font-size: var(--header-xl);
    letter-spacing: -5px;
  }
  .box {
    width: 75%;
    padding: 10px 0px;
    border-radius: 30px;
    margin-top: 40px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.05);
    color: white;
    z-index: 30;
    /*  border: 2px solid white; */
    box-shadow: 0px 0px 20px 5px rgba(0, 0, 0, 0.05);
  }
  .uppercase {
    font-size: var(--text-lg);
    font-family: "AktivGrotesk Regular";
    line-height: var(--30px);
    text-transform: uppercase !important;
    color: rgb(219, 219, 219);
  }
  .bold {
    font-family: "AktivGrotesk Bold";
    position: relative;
    display: inline;
    color: white;
    background-image: linear-gradient(to right, #dbe120 0%, #dbe120 100%);
    background-repeat: no-repeat;
    background-size: 0% 2px;
    background-position: left bottom;
    transition: background-size 0.8s ease-in-out;
    padding-bottom: 2px;
  }
  .bold.animate-underline {
    background-size: 100% 2px;
  }
  /* MEDIA */

  @media (max-width: 1300px) {
    .container {
      max-width: 1000px;
    }
  }

  @media (max-width: 1300px), (max-height: 800px) {
    .box {
      width: 70%;
    }
    .uppercase {
      font-size: var(--text-md);
      line-height: 27px;
    }

    .korte {
      width: 100%;
    }
    h2 {
      font-size: var(--header-md);
      text-align: center;
      line-height: 80px;
    }
    .three {
      font-size: var(--header-lg);
    }
  }

  @media (max-width: 1050px) {
    .container {
      max-width: 700px;
    }
    .grid {
      gap: 40px;
    }
  }

  @media (max-width: 1050px), (max-height: 600px) {
    .box {
      width: 95%;
    }
    .uppercase {
      font-size: var(--text-base);
      line-height: 24px;
    }

    .korte {
      width: 100%;
    }
  }

  @media (max-width: 768px) {
    .box {
      width: 70%;
    }
    .background3 {
      height: 190%;
    }
    .uppercase {
      font-size: var(--text-base);
      line-height: 24px;
    }
    .background3 {
      left: -10px;
      width: 105vw;
    }
    .grid {
      display: flex;
      /*  grid-template-columns: repeat(1, 250px); */
      flex-direction: column;
      width: 100%;
      margin: 0 auto;
      gap: 20px;
      margin-bottom: 20px;
      align-items: center;
    }
    .griditem {
      max-width: 250px;
    }
    .korte {
      width: 100%;
    }
    h2 {
      font-size: var(--header-xs);
      text-align: center;
      line-height: var(--header-sm);
    }
    .three {
      font-size: calc(var(--header-sm) - 0.417rem);
      letter-spacing: -2px;
    }

    .container {
      height: 1300px;
      padding-top: 400px;
      max-width: 100%;
      width: 100%;
      /*   display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center; */
      /*   padding-left: 20%; */
    }
    .box {
      width: 80%;
      padding: 10px 20px;
      border: none;
      /*  margin-top: ; */
    }
    .uppercase {
      font-size: var(--text-sm);
      line-height: 23px;
    }
    .info {
      font-size: var(--text-base);
    }
  }
  /* 
  @media (min-height: 900px) {
    .background3 {
      position: absolute;
      width: 100vw;
      height: 180%;
      top: 0;
      left: 0;
      z-index: 20;
    }
  } */
</style>
